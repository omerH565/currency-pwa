<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Currency Liquid Custom</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text: #ffffff;
            --primary: #007AFF;
            --cols: 3; /* ××©×ª× ×” ×“×™× ××™ ×œ×›××•×ª ×¢××•×“×•×ª */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0; font-family: -apple-system, system-ui, sans-serif;
            background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh; display: flex; flex-direction: column;
            color: var(--text); overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            padding: 10px; display: flex; flex-direction: column;
            height: 100%; max-width: 600px; margin: 0 auto; width: 100%;
            position: relative;
        }

        /* ×›×¤×ª×•×¨ ×¤×œ×•×¡ (×”×’×“×¨×•×ª) */
        .settings-btn {
            position: absolute; top: 15px; left: 15px;
            width: 40px; height: 40px; border-radius: 50%;
            background: var(--glass); border: 1px solid var(--glass-border);
            color: white; font-size: 24px; display: flex;
            align-items: center; justify-content: center; z-index: 50;
            backdrop-filter: blur(10px);
        }

        /* ×’×¨×™×“ ×”××“×™× ×•×ª */
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(var(--cols), 1fr);
            gap: 10px; overflow-y: auto; padding: 60px 5px 20px 5px;
            flex-grow: 1; align-content: start;
        }

        .liquid-card {
            background: var(--glass); backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 15px 5px;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; transition: all 0.15s ease;
            text-align: center; min-height: 100px; aspect-ratio: 1/1;
        }

        .liquid-card.active {
            background: rgba(255, 255, 255, 0.35); border: 1.5px solid #fff;
            transform: scale(1.05);
        }

        .liquid-card .flag { font-size: 28px; margin-bottom: 5px; }
        .liquid-card .code { font-weight: 600; font-size: 12px; opacity: 0.7; }
        .liquid-card .val { font-size: 14px; font-weight: bold; margin-top: 5px; }

        /* ×œ×•×— ××§×©×™× */
        .keypad {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
            padding: 15px; background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(25px); border-radius: 30px 30px 0 0;
            margin: 0 -10px -10px -10px;
        }

        .key {
            background: rgba(255, 255, 255, 0.1); border: 1px solid var(--glass-border);
            border-radius: 15px; padding: 18px; font-size: 20px;
            color: white; text-align: center; cursor: pointer;
        }

        .key:active { background: rgba(255, 255, 255, 0.3); }

        /* ×—×œ×•×Ÿ ×”×’×“×¨×•×ª (Modal) */
        #settingsModal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            z-index: 100; display: none; padding: 40px 20px;
            flex-direction: column; overflow-y: auto;
        }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .close-btn { font-size: 30px; cursor: pointer; }
        
        .setting-section { margin-bottom: 30px; background: var(--glass); padding: 15px; border-radius: 15px; }
        .setting-title { font-size: 14px; opacity: 0.6; margin-bottom: 10px; display: block; }
        
        .col-switcher { display: flex; gap: 10px; }
        .col-btn { flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); border-radius: 10px; color: white; text-align: center; }
        .col-btn.active { background: var(--primary); }

        .currency-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .btn-action { background: none; border: none; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <button class="settings-btn" onclick="toggleModal(true)">+</button>
    <div class="favorites-grid" id="grid"></div>

    <div class="keypad">
        <div class="key" onclick="press('3')">3</div>
        <div class="key" onclick="press('2')">2</div>
        <div class="key" onclick="press('1')">1</div>
        <div class="key" onclick="press('6')">6</div>
        <div class="key" onclick="press('5')">5</div>
        <div class="key" onclick="press('4')">4</div>
        <div class="key" onclick="press('9')">9</div>
        <div class="key" onclick="press('8')">8</div>
        <div class="key" onclick="press('7')">7</div>
        <div class="key" onclick="press('.')">.</div>
        <div class="key" onclick="press('0')">0</div>
        <div class="key" style="color:#ff3b30" onclick="press('DEL')">âŒ«</div>
        <div class="key" style="grid-column: span 3; font-size: 14px;" onclick="press('AC')">××™×¤×•×¡</div>
    </div>
</div>

<div id="settingsModal">
    <div class="modal-header">
        <h2>×”×’×“×¨×•×ª</h2>
        <span class="close-btn" onclick="toggleModal(false)">âœ•</span>
    </div>

    <div class="setting-section">
        <span class="setting-title">×›××•×ª ×¢××•×“×•×ª</span>
        <div class="col-switcher">
            <div class="col-btn" id="col2" onclick="setCols(2)">2</div>
            <div class="col-btn" id="col3" onclick="setCols(3)">3</div>
            <div class="col-btn" id="col4" onclick="setCols(4)">4</div>
        </div>
    </div>

    <div class="setting-section">
        <span class="setting-title">× ×™×”×•×œ ××˜×‘×¢×•×ª</span>
        <div id="modalCurrencyList"></div>
    </div>
</div>

<script>
    const currencyData = {
        "ILS": {flag: "ğŸ‡®ğŸ‡±", symbol: "â‚ª"}, "USD": {flag: "ğŸ‡ºğŸ‡¸", symbol: "$"},
        "EUR": {flag: "ğŸ‡ªğŸ‡º", symbol: "â‚¬"}, "GBP": {flag: "ğŸ‡¬ğŸ‡§", symbol: "Â£"},
        "JPY": {flag: "ğŸ‡¯ğŸ‡µ", symbol: "Â¥"}, "THB": {flag: "ğŸ‡¹ğŸ‡­", symbol: "à¸¿"},
        "CAD": {flag: "ğŸ‡¨ğŸ‡¦", symbol: "C$"}, "AUD": {flag: "ğŸ‡¦ğŸ‡º", symbol: "A$"},
        "CHF": {flag: "ğŸ‡¨ğŸ‡­", symbol: "Fr"}, "TRY": {flag: "ğŸ‡¹ğŸ‡·", symbol: "â‚º"}
    };

    let favorites = JSON.parse(localStorage.getItem('favs_liq_v3')) || ["ILS", "USD", "EUR"];
    let baseCurrency = localStorage.getItem('base_liq_v3') || "ILS";
    let colCount = parseInt(localStorage.getItem('cols_liq')) || 3;
    let currentInput = "100";
    let rates = {};

    async function fetchRates() {
        try {
            const res = await fetch(`https://api.frankfurter.app/latest?from=${baseCurrency}`);
            const data = await res.json();
            rates = data.rates;
            rates[baseCurrency] = 1;
            renderGrid();
        } catch (e) { console.log("Offline or Error"); }
    }

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        document.documentElement.style.setProperty('--cols', colCount);

        favorites.forEach(code => {
            const card = document.createElement('div');
            card.className = `liquid-card ${code === baseCurrency ? 'active' : ''}`;
            card.id = `card-${code}`;
            card.onclick = () => selectBase(code);
            card.innerHTML = `
                <div class="flag">${currencyData[code].flag}</div>
                <div class="code">${code}</div>
                <div class="val" id="val-${code}">---</div>
            `;
            grid.appendChild(card);
        });
        updateValuesOnly();
    }

    function updateValuesOnly() {
        const numInput = parseFloat(currentInput) || 0;
        favorites.forEach(code => {
            const el = document.getElementById(`val-${code}`);
            if (el) {
                const converted = rates[code] ? (numInput * rates[code]).toFixed(2) : '...';
                el.innerText = currencyData[code].symbol + (code === baseCurrency ? numInput : converted);
            }
        });
    }

    function press(key) {
        if (key === 'AC') currentInput = "0";
        else if (key === 'DEL') currentInput = currentInput.slice(0, -1) || "0";
        else {
            if (currentInput === "0" && key !== '.') currentInput = key;
            else if (currentInput.length < 9) currentInput += key;
        }
        updateValuesOnly();
    }

    function selectBase(code) {
        baseCurrency = code;
        localStorage.setItem('base_liq_v3', code);
        fetchRates();
    }

    function toggleModal(show) {
        const modal = document.getElementById('settingsModal');
        modal.style.display = show ? 'flex' : 'none';
        if (show) renderModalList();
    }

    function setCols(n) {
        colCount = n;
        localStorage.setItem('cols_liq', n);
        document.querySelectorAll('.col-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('col'+n).classList.add('active');
        renderGrid();
    }

    function renderModalList() {
        const list = document.getElementById('modalCurrencyList');
        list.innerHTML = '';
        Object.keys(currencyData).forEach(code => {
            const isFav = favorites.includes(code);
            list.innerHTML += `
                <div class="currency-item">
                    <span>${currencyData[code].flag} ${code}</span>
                    <button class="btn-action" onclick="toggleFav('${code}')" style="color:${isFav?'#ff3b30':'#4cd964'}">
                        ${isFav ? 'âœ•' : '+'}
                    </button>
                </div>
            `;
        });
        document.getElementById('col'+colCount).classList.add('active');
    }

    function toggleFav(code) {
        if (favorites.includes(code)) {
            if (favorites.length > 1) favorites = favorites.filter(c => c !== code);
            if (baseCurrency === code) baseCurrency = favorites[0];
        } else {
            favorites.push(code);
        }
        localStorage.setItem('favs_liq_v3', JSON.stringify(favorites));
        renderModalList();
        fetchRates();
    }

    fetchRates();
</script>
</body>
</html>
