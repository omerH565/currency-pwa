<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Currency Liquid Full</title>
    
    <meta name="theme-color" content="#0f0c29">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text: #ffffff;
            --primary: #007AFF;
            --cols: 3;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0; font-family: -apple-system, system-ui, sans-serif;
            /* ×¨×§×¢ ×›×”×” ×©××ª××™× ×œ×¡×˜×˜×•×¡ ×‘×¨ */
            background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh; display: flex; flex-direction: column;
            color: var(--text); overflow: hidden;
            /* ×“×•××’ ×©×”×ª×•×›×Ÿ ×™×ª×—×™×œ ××ª×—×ª ×œ×¡×˜×˜×•×¡ ×‘×¨ ×‘××™×™×¤×•×Ÿ */
            padding-top: env(safe-area-inset-top);
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            padding: 10px; display: flex; flex-direction: column;
            height: 100%; max-width: 600px; margin: 0 auto; width: 100%;
            position: relative;
        }

        .settings-btn {
            position: absolute; top: 10px; left: 15px;
            width: 36px; height: 36px; border-radius: 50%;
            background: var(--glass); border: 1px solid var(--glass-border);
            color: white; font-size: 20px; display: flex;
            align-items: center; justify-content: center; z-index: 50;
            backdrop-filter: blur(10px);
        }

        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(var(--cols), 1fr);
            gap: 10px; overflow-y: auto; padding: 50px 5px 20px 5px;
            flex-grow: 1; align-content: start;
        }

        .liquid-card {
            background: var(--glass); backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; transition: all 0.1s ease;
            text-align: center; aspect-ratio: 1/1;
        }

        .liquid-card.active {
            background: rgba(255, 255, 255, 0.35); border: 1.5px solid #fff;
            transform: scale(1.03);
        }

        .liquid-card .flag { font-size: 24px; margin-bottom: 4px; }
        .liquid-card .code { font-weight: 600; font-size: 11px; opacity: 0.7; text-transform: uppercase; }
        .liquid-card .val { font-size: 13px; font-weight: bold; margin-top: 4px; overflow: hidden; }

        .keypad {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;
            padding: 15px; padding-bottom: calc(15px + env(safe-area-inset-bottom));
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(25px); border-radius: 25px 25px 0 0;
            margin: 0 -10px -10px -10px;
        }

        .key {
            background: rgba(255, 255, 255, 0.08); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 15px; font-size: 20px;
            color: white; text-align: center; cursor: pointer;
        }

        .key:active { background: rgba(255, 255, 255, 0.2); }

        /* Modal */
        #settingsModal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            z-index: 100; display: none; padding: 60px 20px 20px;
            flex-direction: column;
        }

        .modal-content { overflow-y: auto; flex-grow: 1; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .setting-section { margin-bottom: 20px; background: var(--glass); padding: 15px; border-radius: 15px; }
        .col-switcher { display: flex; gap: 8px; }
        .col-btn { flex: 1; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); border-radius: 8px; color: white; text-align: center; font-size: 14px; }
        .col-btn.active { background: var(--primary); }
        .currency-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body>

<div class="container">
    <button class="settings-btn" onclick="toggleModal(true)">+</button>
    <div class="favorites-grid" id="grid"></div>

    <div class="keypad">
        <div class="key" onclick="press('3')">3</div>
        <div class="key" onclick="press('2')">2</div>
        <div class="key" onclick="press('1')">1</div>
        <div class="key" onclick="press('6')">6</div>
        <div class="key" onclick="press('5')">5</div>
        <div class="key" onclick="press('4')">4</div>
        <div class="key" onclick="press('9')">9</div>
        <div class="key" onclick="press('8')">8</div>
        <div class="key" onclick="press('7')">7</div>
        <div class="key" onclick="press('.')">.</div>
        <div class="key" onclick="press('0')">0</div>
        <div class="key" style="color:#ff3b30" onclick="press('DEL')">âŒ«</div>
        <div class="key" style="grid-column: span 3; font-size: 14px; padding: 10px;" onclick="press('AC')">××™×¤×•×¡</div>
    </div>
</div>

<div id="settingsModal">
    <div class="modal-header">
        <h2 style="margin:0">×”×’×“×¨×•×ª</h2>
        <span style="font-size:24px" onclick="toggleModal(false)">âœ•</span>
    </div>
    <div class="modal-content">
        <div class="setting-section">
            <label style="font-size:12px; opacity:0.6; display:block; margin-bottom:8px">×›××•×ª ×¢××•×“×•×ª</label>
            <div class="col-switcher">
                <div class="col-btn" id="col2" onclick="setCols(2)">2</div>
                <div class="col-btn" id="col3" onclick="setCols(3)">3</div>
                <div class="col-btn" id="col4" onclick="setCols(4)">4</div>
            </div>
        </div>
        <div class="setting-section">
            <label style="font-size:12px; opacity:0.6; display:block; margin-bottom:8px">××˜×‘×¢×•×ª</label>
            <div id="modalCurrencyList"></div>
        </div>
    </div>
</div>

<script>
    const currencyData = {
        "ILS": {flag: "ğŸ‡®ğŸ‡±", symbol: "â‚ª"}, "USD": {flag: "ğŸ‡ºğŸ‡¸", symbol: "$"},
        "EUR": {flag: "ğŸ‡ªğŸ‡º", symbol: "â‚¬"}, "GBP": {flag: "ğŸ‡¬ğŸ‡§", symbol: "Â£"},
        "JPY": {flag: "ğŸ‡¯ğŸ‡µ", symbol: "Â¥"}, "THB": {flag: "ğŸ‡¹ğŸ‡­", symbol: "à¸¿"},
        "CZK": {flag: "ğŸ‡¨ğŸ‡¿", symbol: "KÄ"}, "CHF": {flag: "ğŸ‡¨ğŸ‡­", symbol: "Fr"},
        "TRY": {flag: "ğŸ‡¹ğŸ‡·", symbol: "â‚º"}, "CAD": {flag: "ğŸ‡¨ğŸ‡¦", symbol: "C$"},
        "AUD": {flag: "ğŸ‡¦ğŸ‡º", symbol: "A$"}, "HUF": {flag: "ğŸ‡­ğŸ‡º", symbol: "Ft"}
    };

    let favorites = JSON.parse(localStorage.getItem('fav_v4')) || ["ILS", "USD", "EUR", "CZK"];
    let baseCurrency = localStorage.getItem('base_v4') || "ILS";
    let colCount = parseInt(localStorage.getItem('col_v4')) || 3;
    let currentInput = "100";
    let rates = {};

    async function fetchRates() {
        try {
            const res = await fetch(`https://api.frankfurter.app/latest?from=${baseCurrency}`);
            const data = await res.json();
            rates = data.rates;
            rates[baseCurrency] = 1;
            render();
        } catch (e) {}
    }

    function press(key) {
        if (key === 'AC') currentInput = "0";
        else if (key === 'DEL') currentInput = currentInput.slice(0, -1) || "0";
        else {
            if (currentInput === "0" && key !== '.') currentInput = key;
            else if (currentInput.length < 9) currentInput += key;
        }
        updateUI();
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        document.documentElement.style.setProperty('--cols', colCount);
        favorites.forEach(code => {
            grid.innerHTML += `
                <div id="card-${code}" class="liquid-card ${code === baseCurrency ? 'active' : ''}" onclick="setBase('${code}')">
                    <div class="flag">${currencyData[code].flag}</div>
                    <div class="code">${code}</div>
                    <div class="val" id="val-${code}">---</div>
                </div>
            `;
        });
        updateUI();
    }

    function updateUI() {
        const num = parseFloat(currentInput) || 0;
        favorites.forEach(code => {
            const el = document.getElementById(`val-${code}`);
            if (el) {
                const v = code === baseCurrency ? num : (rates[code] ? (num * rates[code]).toFixed(2) : '...');
                el.innerText = currencyData[code].symbol + v;
            }
        });
    }

    function setBase(code) {
        baseCurrency = code;
        localStorage.setItem('base_v4', code);
        fetchRates();
    }

    function toggleModal(s) {
        document.getElementById('settingsModal').style.display = s ? 'flex' : 'none';
        if(s) renderModal();
    }

    function setCols(n) {
        colCount = n;
        localStorage.setItem('col_v4', n);
        render();
        renderModal();
    }

    function renderModal() {
        const list = document.getElementById('modalCurrencyList');
        list.innerHTML = '';
        Object.keys(currencyData).forEach(code => {
            const isFav = favorites.includes(code);
            list.innerHTML += `
                <div class="currency-item">
                    <span>${currencyData[code].flag} ${code}</span>
                    <button onclick="toggleFav('${code}')" style="background:none; border:none; color:${isFav?'#ff3b30':'#4cd964'}; font-size:18px">
                        ${isFav ? 'âœ•' : '+'}
                    </button>
                </div>
            `;
        });
        [2,3,4].forEach(n => document.getElementById('col'+n).className = n === colCount ? 'col-btn active' : 'col-btn');
    }

    function toggleFav(code) {
        if (favorites.includes(code)) {
            if(favorites.length > 1) favorites = favorites.filter(c => c !== code);
            if(baseCurrency === code) baseCurrency = favorites[0];
        } else favorites.push(code);
        localStorage.setItem('fav_v4', JSON.stringify(favorites));
        renderModal();
        fetchRates();
    }

    fetchRates();
</script>
</body>
</html>
